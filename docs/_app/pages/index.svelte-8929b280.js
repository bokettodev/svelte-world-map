import{M as Dt,N as _t,O as mt,P as Ht,Q as z,R as Pt,S as lt,i as ut,s as ct,e as c,t as O,k as R,c as p,a as g,h as T,d as v,m as y,b as C,g as nt,H as r,T as E,U as m,L as ht,V as It,W as jt,X as Lt,w as Et,x as Wt,Y as kt,y as St,Z as Bt,q as bt,o as Mt,B as xt,v as Vt,_ as Rt,$ as yt}from"../chunks/vendor-6312896e.js";function zt(s,t){let e;return(...n)=>{clearTimeout(e),e=setTimeout(()=>{s.apply(this,n)},t)}}function Ot(s,t,e,n){!s||!t||!e||!n||s.fitSize([t,e],n)}class Tt{constructor(){this.processing=!1,this.canvasColor="white",this.sphereColor="darkslategray",this.waterColor="white",this.boundariesColor="white",this.earthColor="darkslategray",this.hoverColor="green",this.onMouseMove=t=>{var o;if(this.processing||!((o=this.countries)!=null&&o.length))return;const e=this.canvasContext.canvas.getBoundingClientRect(),n=t.offsetY-e.y,h=t.offsetX-e.x,a=this.countries.find(l=>{const u=this.processing?l.pathLowResolution:l.pathHighResolution;return this.canvasContext.isPointInPath(u,h,n)});this.hoveredCountry!==a&&(this.hoveredCountry&&(this.hoveredCountry.color=this.earthColor,this.hoveredCountry.isHovered=!1),a?(this.hoveredCountry=a,this.hoveredCountry.color=this.hoverColor,this.hoveredCountry.isHovered=!0):this.hoveredCountry=null,this.renderCanvas())}}init(t){this.initVariables(t),this.initPanAndZoomListener(),this.initHoverListener()}setWorldDataset(t){var e,n,h,a;!((n=(e=t==null?void 0:t.lowResolution)==null?void 0:e.features)!=null&&n.length)||!((a=(h=t==null?void 0:t.highResolution)==null?void 0:h.features)!=null&&a.length)||(this.worldDataset=t,this.countries=this.worldDataset.maxResolution.features.map(o=>({featureLowResolution:this.worldDataset.minResolution.features.find(u=>u.properties.name===o.properties.name),featureHighResolution:o,pathLowResolution:null,pathHighResolution:null,name:o.properties.name,color:this.earthColor,isHovered:!1})))}setCanvasColor(t){this.canvasColor=t}setSphereColor(t){this.sphereColor=t}setWaterColor(t){this.waterColor=t}setBoundariesColor(t){this.boundariesColor=t}setEarthColor(t){this.earthColor=t,this.countries.forEach(e=>e.isHovered?null:e.color=t)}setHoverColor(t){this.hoverColor=t,this.hoveredCountry&&(this.hoveredCountry.color=t)}drawMapWithCalculations(){Ot(this.projection,this.width,this.height,this.worldDataset.maxResolution),this.setCountriesPaths(),this.renderCanvas()}drawMapWithoutCalculations(){this.renderCanvas()}initVariables(t){this.projection=Dt(),this.canvasContext=t.getContext("2d"),this.pathGenerator=_t(this.projection),this.pathGeneratorWithContext=_t(this.projection,this.canvasContext)}initPanAndZoomListener(){mt(this.canvasContext.canvas).call(Ht().scaleExtent([1,8]).on("start",t=>{this.processing=!0;const e=this.projection.rotate();this.versorOnDragStart={rotate:e,cartesian:z.cartesian(this.projection.invert(Pt(t.sourceEvent,this.canvasContext.canvas))),matrix:z(e)}}).on("zoom",t=>{this.projection.scale(t.transform.k*(this.height/2));const e=z.cartesian(this.projection.rotate(this.versorOnDragStart.rotate).invert(Pt(t.sourceEvent,this.canvasContext.canvas))),n=z.multiply(this.versorOnDragStart.matrix,z.delta(this.versorOnDragStart.cartesian,e));this.projection.rotate(z.rotation(n)),this.setCountriesPaths(),this.renderCanvas()}).on("end",()=>{this.processing=!1,this.setCountriesPaths(),this.renderCanvas()}))}initHoverListener(){mt(this.canvasContext.canvas).on("mousemove",this.onMouseMove)}setCountriesPaths(){this.processing?this.countries.forEach(t=>{t.pathLowResolution=t.featureLowResolution?new Path2D(this.pathGenerator(t.featureLowResolution)):null}):this.countries.forEach(t=>{t.pathHighResolution=new Path2D(this.pathGenerator(t.featureHighResolution))})}renderCanvas(){window.requestAnimationFrame(()=>{this.canvasContext.clearRect(0,0,this.width,this.height),this.canvasContext.fillStyle=this.canvasColor,this.canvasContext.fillRect(0,0,this.width,this.height),this.drawWater(),this.countries.forEach(t=>{this.drawCountry(t)}),this.drawEarthBoundary()})}drawWater(){this.canvasContext.beginPath(),this.pathGeneratorWithContext({type:"Sphere"}),this.canvasContext.fillStyle=this.waterColor,this.canvasContext.fill(),this.canvasContext.closePath()}drawCountry(t){const e=this.processing?t.pathLowResolution:t.pathHighResolution;!e||(this.canvasContext.beginPath(),this.canvasContext.strokeStyle=this.boundariesColor,this.canvasContext.stroke(e),this.canvasContext.fillStyle=t.color,this.canvasContext.fill(e),this.canvasContext.closePath())}drawEarthBoundary(){this.canvasContext.beginPath(),this.pathGeneratorWithContext({type:"Sphere"}),this.canvasContext.strokeStyle=this.sphereColor,this.canvasContext.stroke(),this.canvasContext.closePath()}get width(){return this.canvasContext.canvas.width}get height(){return this.canvasContext.canvas.height}}function Nt(s){let t,e,n,h,a,o,l,u,_,W,I,w,j,P,L,N,U,S,G,b,B,A,q,M,X,x,V,Y,Z,D,F,d,Q,rt,at,k,K,H,it,pt;return{c(){t=c("div"),e=c("div"),n=c("p"),h=O("Background"),a=R(),o=c("input"),l=R(),u=c("div"),_=c("p"),W=O("Sphere"),I=R(),w=c("input"),j=R(),P=c("div"),L=c("p"),N=O("Water"),U=R(),S=c("input"),G=R(),b=c("div"),B=c("p"),A=O("Boundaries"),q=R(),M=c("input"),X=R(),x=c("div"),V=c("p"),Y=O("Earth"),Z=R(),D=c("input"),F=R(),d=c("div"),Q=c("p"),rt=O("Hover"),at=R(),k=c("input"),K=R(),H=c("canvas"),this.h()},l(f){t=p(f,"DIV",{class:!0});var i=g(t);e=p(i,"DIV",{class:!0});var J=g(e);n=p(J,"P",{});var ft=g(n);h=T(ft,"Background"),ft.forEach(v),a=y(J),o=p(J,"INPUT",{type:!0}),J.forEach(v),l=y(i),u=p(i,"DIV",{class:!0});var $=g(u);_=p($,"P",{});var vt=g(_);W=T(vt,"Sphere"),vt.forEach(v),I=y($),w=p($,"INPUT",{type:!0}),$.forEach(v),j=y(i),P=p(i,"DIV",{class:!0});var tt=g(P);L=p(tt,"P",{});var dt=g(L);N=T(dt,"Water"),dt.forEach(v),U=y(tt),S=p(tt,"INPUT",{type:!0}),tt.forEach(v),G=y(i),b=p(i,"DIV",{class:!0});var et=g(b);B=p(et,"P",{});var Ct=g(B);A=T(Ct,"Boundaries"),Ct.forEach(v),q=y(et),M=p(et,"INPUT",{type:!0}),et.forEach(v),X=y(i),x=p(i,"DIV",{class:!0});var ot=g(x);V=p(ot,"P",{});var gt=g(V);Y=T(gt,"Earth"),gt.forEach(v),Z=y(ot),D=p(ot,"INPUT",{type:!0}),ot.forEach(v),F=y(i),d=p(i,"DIV",{class:!0});var st=g(d);Q=p(st,"P",{});var wt=g(Q);rt=T(wt,"Hover"),wt.forEach(v),at=y(st),k=p(st,"INPUT",{type:!0}),st.forEach(v),i.forEach(v),K=y(f),H=p(f,"CANVAS",{width:!0,height:!0}),g(H).forEach(v),this.h()},h(){C(o,"type","color"),C(e,"class","color svelte-wnf8xa"),C(w,"type","color"),C(u,"class","color svelte-wnf8xa"),C(S,"type","color"),C(P,"class","color svelte-wnf8xa"),C(M,"type","color"),C(b,"class","color svelte-wnf8xa"),C(D,"type","color"),C(x,"class","color svelte-wnf8xa"),C(k,"type","color"),C(d,"class","color svelte-wnf8xa"),C(t,"class","colors svelte-wnf8xa"),C(H,"width",s[0]),C(H,"height",s[1])},m(f,i){nt(f,t,i),r(t,e),r(e,n),r(n,h),r(e,a),r(e,o),E(o,s[3]),r(t,l),r(t,u),r(u,_),r(_,W),r(u,I),r(u,w),E(w,s[4]),r(t,j),r(t,P),r(P,L),r(L,N),r(P,U),r(P,S),E(S,s[5]),r(t,G),r(t,b),r(b,B),r(B,A),r(b,q),r(b,M),E(M,s[6]),r(t,X),r(t,x),r(x,V),r(V,Y),r(x,Z),r(x,D),E(D,s[7]),r(t,F),r(t,d),r(d,Q),r(Q,rt),r(d,at),r(d,k),E(k,s[8]),nt(f,K,i),nt(f,H,i),s[23](H),it||(pt=[m(window,"resize",s[9]),m(o,"input",s[17]),m(o,"change",s[10]),m(w,"input",s[18]),m(w,"change",s[11]),m(S,"input",s[19]),m(S,"change",s[12]),m(M,"input",s[20]),m(M,"change",s[13]),m(D,"input",s[21]),m(D,"change",s[14]),m(k,"input",s[22]),m(k,"change",s[15])],it=!0)},p(f,[i]){i&8&&E(o,f[3]),i&16&&E(w,f[4]),i&32&&E(S,f[5]),i&64&&E(M,f[6]),i&128&&E(D,f[7]),i&256&&E(k,f[8]),i&1&&C(H,"width",f[0]),i&2&&C(H,"height",f[1])},i:ht,o:ht,d(f){f&&v(t),f&&v(K),f&&v(H),s[23](null),it=!1,It(pt)}}}const Ut=300;function Gt(s,t,e){let{worldDataset:n}=t,{width:h}=t,{height:a}=t;const o=new Tt;let l,u="#cfcfcf",_="#2f4f4f",W="#ffffff",I="#ffffff",w="#2f4f4f",j="#3e9987",P=!1,L=!1;const N=zt(()=>{o.drawMapWithCalculations()},Ut);jt(()=>{S()});function U(){P||!l||(P=!0,o.init(l))}function S(){U(),!(!P||L||!n)&&(L=!0,o.setWorldDataset(n),o.setCanvasColor(u),o.setSphereColor(_),o.setWaterColor(W),o.setBoundariesColor(I),o.setEarthColor(w),o.setHoverColor(j),o.drawMapWithCalculations())}const G=()=>{o.setCanvasColor(u),o.drawMapWithoutCalculations()},b=()=>{o.setSphereColor(_),o.drawMapWithoutCalculations()},B=()=>{o.setWaterColor(W),o.drawMapWithoutCalculations()},A=()=>{o.setBoundariesColor(I),o.drawMapWithoutCalculations()},q=()=>{o.setEarthColor(w),o.drawMapWithoutCalculations()},M=()=>{o.setHoverColor(j),o.drawMapWithoutCalculations()};function X(){u=this.value,e(3,u)}function x(){_=this.value,e(4,_)}function V(){W=this.value,e(5,W)}function Y(){I=this.value,e(6,I)}function Z(){w=this.value,e(7,w)}function D(){j=this.value,e(8,j)}function F(d){Lt[d?"unshift":"push"](()=>{l=d,e(2,l)})}return s.$$set=d=>{"worldDataset"in d&&e(16,n=d.worldDataset),"width"in d&&e(0,h=d.width),"height"in d&&e(1,a=d.height)},[h,a,l,u,_,W,I,w,j,N,G,b,B,A,q,M,n,X,x,V,Y,Z,D,F]}class At extends lt{constructor(t){super();ut(this,t,Gt,Nt,ct,{worldDataset:16,width:0,height:1})}}class qt{constructor(t,e){this.lowResolution=t,this.highResolution=e}get minResolution(){return this.lowResolution||this.highResolution}get maxResolution(){return this.highResolution||this.lowResolution}}function Xt(s){let t,e,n,h;return e=new At({props:{worldDataset:s[2],width:s[0],height:s[1]}}),{c(){t=c("div"),Et(e.$$.fragment),this.h()},l(a){t=p(a,"DIV",{class:!0});var o=g(t);Wt(e.$$.fragment,o),o.forEach(v),this.h()},h(){C(t,"class","svelte-10lepfb"),kt(()=>s[3].call(t))},m(a,o){nt(a,t,o),St(e,t,null),n=Bt(t,s[3].bind(t)),h=!0},p(a,[o]){const l={};o&4&&(l.worldDataset=a[2]),o&1&&(l.width=a[0]),o&2&&(l.height=a[1]),e.$set(l)},i(a){h||(bt(e.$$.fragment,a),h=!0)},o(a){Mt(e.$$.fragment,a),h=!1},d(a){a&&v(t),xt(e),n()}}}function Yt(s,t,e){let n,h,a;Vt(()=>{Promise.all([Rt("countries-110m.topo.json"),Rt("countries-50m.topo.json")]).then(([l,u])=>{const _=yt(l,l.objects.countries),W=yt(u,u.objects.countries);e(2,a=new qt(_,W))})});function o(){n=this.clientWidth,h=this.clientHeight,e(0,n),e(1,h)}return[n,h,a,o]}class Zt extends lt{constructor(t){super();ut(this,t,Yt,Xt,ct,{})}}function Ft(s){let t,e;return t=new Zt({}),{c(){Et(t.$$.fragment)},l(n){Wt(t.$$.fragment,n)},m(n,h){St(t,n,h),e=!0},p:ht,i(n){e||(bt(t.$$.fragment,n),e=!0)},o(n){Mt(t.$$.fragment,n),e=!1},d(n){xt(t,n)}}}class Kt extends lt{constructor(t){super();ut(this,t,null,Ft,ct,{})}}export{Kt as default};
