import{M as Dt,N as wt,O as mt,P as Ht,Q as z,R as Pt,S as lt,i as ut,s as ct,e as c,k as P,t as O,c as p,a as _,d,m as R,h as T,b as v,g as st,H as n,T as y,U as w,L as ht,V as It,W as jt,X as Lt,w as Et,x as Wt,Y as kt,y as St,Z as Bt,q as bt,o as xt,B as Mt,v as Vt,_ as Rt,$ as yt}from"../chunks/vendor-6312896e.js";function qt(r,t){let e;return(...o)=>{clearTimeout(e),e=setTimeout(()=>{r.apply(this,o)},t)}}function zt(r,t,e,o){!r||!t||!e||!o||r.fitSize([t,e],o)}class Ot{constructor(){this.processing=!1,this.canvasColor="white",this.sphereColor="darkslategray",this.waterColor="white",this.boundariesColor="white",this.earthColor="darkslategray",this.hoverColor="green",this.onMouseMove=t=>{var s;if(this.processing||!((s=this.countries)!=null&&s.length))return;const e=this.canvasContext.canvas.getBoundingClientRect(),o=t.offsetY-e.y,a=t.offsetX-e.x,i=this.countries.find(l=>{const u=this.processing?l.pathLowResolution:l.pathHighResolution;return this.canvasContext.isPointInPath(u,a,o)});this.hoveredCountry!==i&&(this.hoveredCountry&&(this.hoveredCountry.color=this.earthColor,this.hoveredCountry.isHovered=!1),i?(this.hoveredCountry=i,this.hoveredCountry.color=this.hoverColor,this.hoveredCountry.isHovered=!0):this.hoveredCountry=null,this.renderCanvas())}}init(t){this.initVariables(t),this.initPanAndZoomListener(),this.initHoverListener()}setWorldDataset(t){var e,o,a,i;!((o=(e=t==null?void 0:t.lowResolution)==null?void 0:e.features)!=null&&o.length)||!((i=(a=t==null?void 0:t.highResolution)==null?void 0:a.features)!=null&&i.length)||(this.worldDataset=t,this.countries=this.worldDataset.maxResolution.features.map(s=>({featureLowResolution:this.worldDataset.minResolution.features.find(u=>u.properties.name===s.properties.name),featureHighResolution:s,pathLowResolution:null,pathHighResolution:null,name:s.properties.name,color:this.earthColor,isHovered:!1})))}setCanvasColor(t){this.canvasColor=t}setSphereColor(t){this.sphereColor=t}setWaterColor(t){this.waterColor=t}setBoundariesColor(t){this.boundariesColor=t}setEarthColor(t){this.earthColor=t,this.countries.forEach(e=>e.isHovered?null:e.color=t)}setHoverColor(t){this.hoverColor=t,this.hoveredCountry&&(this.hoveredCountry.color=t)}drawMapWithCalculations(){zt(this.projection,this.width,this.height,this.worldDataset.maxResolution),this.setCountriesPaths(),this.renderCanvas()}drawMapWithoutCalculations(){this.renderCanvas()}initVariables(t){this.projection=Dt(),this.canvasContext=t.getContext("2d"),this.pathGenerator=wt(this.projection),this.pathGeneratorWithContext=wt(this.projection,this.canvasContext)}initPanAndZoomListener(){mt(this.canvasContext.canvas).call(Ht().scaleExtent([.1,10]).on("start",t=>{this.processing=!0;const e=this.projection.rotate();this.versorOnDragStart={rotate:e,cartesian:z.cartesian(this.projection.invert(Pt(t.sourceEvent,this.canvasContext.canvas))),matrix:z(e)}}).on("zoom",t=>{this.projection.scale(t.transform.k*(this.height/2));const e=z.cartesian(this.projection.rotate(this.versorOnDragStart.rotate).invert(Pt(t.sourceEvent,this.canvasContext.canvas))),o=z.multiply(this.versorOnDragStart.matrix,z.delta(this.versorOnDragStart.cartesian,e));this.projection.rotate(z.rotation(o)),this.setCountriesPaths(),this.renderCanvas()}).on("end",()=>{this.processing=!1,this.setCountriesPaths(),this.renderCanvas()}))}initHoverListener(){mt(this.canvasContext.canvas).on("mousemove",this.onMouseMove)}setCountriesPaths(){this.processing?this.countries.forEach(t=>{t.pathLowResolution=t.featureLowResolution?new Path2D(this.pathGenerator(t.featureLowResolution)):null}):this.countries.forEach(t=>{t.pathHighResolution=new Path2D(this.pathGenerator(t.featureHighResolution))})}renderCanvas(){window.requestAnimationFrame(()=>{this.canvasContext.clearRect(0,0,this.width,this.height),this.canvasContext.fillStyle=this.canvasColor,this.canvasContext.fillRect(0,0,this.width,this.height),this.drawWater(),this.countries.forEach(t=>{this.drawCountry(t)}),this.drawEarthBoundary()})}drawWater(){this.canvasContext.beginPath(),this.pathGeneratorWithContext({type:"Sphere"}),this.canvasContext.fillStyle=this.waterColor,this.canvasContext.fill(),this.canvasContext.closePath()}drawCountry(t){const e=this.processing?t.pathLowResolution:t.pathHighResolution;!e||(this.canvasContext.beginPath(),this.canvasContext.strokeStyle=this.boundariesColor,this.canvasContext.stroke(e),this.canvasContext.fillStyle=t.color,this.canvasContext.fill(e),this.canvasContext.closePath())}drawEarthBoundary(){this.canvasContext.beginPath(),this.pathGeneratorWithContext({type:"Sphere"}),this.canvasContext.strokeStyle=this.sphereColor,this.canvasContext.stroke(),this.canvasContext.closePath()}get width(){return this.canvasContext.canvas.width}get height(){return this.canvasContext.canvas.height}}function Tt(r){let t,e,o,a,i,s,l,u,E,g,W,H,I,m,q,S,k,N,U,b,G,x,B,A,X,M,Y,D,V,Z,F,C,rt,j,Q,nt,it,L,at,pt;return{c(){t=c("canvas"),e=P(),o=c("div"),a=c("div"),i=c("p"),s=O("Background"),l=P(),u=c("input"),E=P(),g=c("div"),W=c("p"),H=O("Sphere"),I=P(),m=c("input"),q=P(),S=c("div"),k=c("p"),N=O("Water"),U=P(),b=c("input"),G=P(),x=c("div"),B=c("p"),A=O("Boundaries"),X=P(),M=c("input"),Y=P(),D=c("div"),V=c("p"),Z=O("Earth"),F=P(),C=c("input"),rt=P(),j=c("div"),Q=c("p"),nt=O("Hover"),it=P(),L=c("input"),this.h()},l(f){t=p(f,"CANVAS",{width:!0,height:!0,class:!0}),_(t).forEach(d),e=R(f),o=p(f,"DIV",{class:!0});var h=_(o);a=p(h,"DIV",{class:!0});var K=_(a);i=p(K,"P",{});var ft=_(i);s=T(ft,"Background"),ft.forEach(d),l=R(K),u=p(K,"INPUT",{type:!0}),K.forEach(d),E=R(h),g=p(h,"DIV",{class:!0});var J=_(g);W=p(J,"P",{});var vt=_(W);H=T(vt,"Sphere"),vt.forEach(d),I=R(J),m=p(J,"INPUT",{type:!0}),J.forEach(d),q=R(h),S=p(h,"DIV",{class:!0});var $=_(S);k=p($,"P",{});var dt=_(k);N=T(dt,"Water"),dt.forEach(d),U=R($),b=p($,"INPUT",{type:!0}),$.forEach(d),G=R(h),x=p(h,"DIV",{class:!0});var tt=_(x);B=p(tt,"P",{});var Ct=_(B);A=T(Ct,"Boundaries"),Ct.forEach(d),X=R(tt),M=p(tt,"INPUT",{type:!0}),tt.forEach(d),Y=R(h),D=p(h,"DIV",{class:!0});var et=_(D);V=p(et,"P",{});var gt=_(V);Z=T(gt,"Earth"),gt.forEach(d),F=R(et),C=p(et,"INPUT",{type:!0}),et.forEach(d),rt=R(h),j=p(h,"DIV",{class:!0});var ot=_(j);Q=p(ot,"P",{});var _t=_(Q);nt=T(_t,"Hover"),_t.forEach(d),it=R(ot),L=p(ot,"INPUT",{type:!0}),ot.forEach(d),h.forEach(d),this.h()},h(){v(t,"width",r[0]),v(t,"height",r[1]),v(t,"class","svelte-rq8n6x"),v(u,"type","color"),v(a,"class","color svelte-rq8n6x"),v(m,"type","color"),v(g,"class","color svelte-rq8n6x"),v(b,"type","color"),v(S,"class","color svelte-rq8n6x"),v(M,"type","color"),v(x,"class","color svelte-rq8n6x"),v(C,"type","color"),v(D,"class","color svelte-rq8n6x"),v(L,"type","color"),v(j,"class","color svelte-rq8n6x"),v(o,"class","colors svelte-rq8n6x")},m(f,h){st(f,t,h),r[17](t),st(f,e,h),st(f,o,h),n(o,a),n(a,i),n(i,s),n(a,l),n(a,u),y(u,r[3]),n(o,E),n(o,g),n(g,W),n(W,H),n(g,I),n(g,m),y(m,r[4]),n(o,q),n(o,S),n(S,k),n(k,N),n(S,U),n(S,b),y(b,r[5]),n(o,G),n(o,x),n(x,B),n(B,A),n(x,X),n(x,M),y(M,r[6]),n(o,Y),n(o,D),n(D,V),n(V,Z),n(D,F),n(D,C),y(C,r[7]),n(o,rt),n(o,j),n(j,Q),n(Q,nt),n(j,it),n(j,L),y(L,r[8]),at||(pt=[w(window,"resize",r[9]),w(u,"input",r[18]),w(u,"change",r[10]),w(m,"input",r[19]),w(m,"change",r[11]),w(b,"input",r[20]),w(b,"change",r[12]),w(M,"input",r[21]),w(M,"change",r[13]),w(C,"input",r[22]),w(C,"change",r[14]),w(L,"input",r[23]),w(L,"change",r[15])],at=!0)},p(f,[h]){h&1&&v(t,"width",f[0]),h&2&&v(t,"height",f[1]),h&8&&y(u,f[3]),h&16&&y(m,f[4]),h&32&&y(b,f[5]),h&64&&y(M,f[6]),h&128&&y(C,f[7]),h&256&&y(L,f[8])},i:ht,o:ht,d(f){f&&d(t),r[17](null),f&&d(e),f&&d(o),at=!1,It(pt)}}}const Nt=300;function Ut(r,t,e){let{worldDataset:o}=t,{width:a}=t,{height:i}=t;const s=new Ot;let l,u="#cfcfcf",E="#2f4f4f",g="#ffffff",W="#ffffff",H="#2f4f4f",I="#3e9987",m=!1,q=!1;const S=qt(()=>{s.drawMapWithCalculations()},Nt);jt(()=>{N()});function k(){m||!l||(m=!0,s.init(l))}function N(){k(),!(!m||q||!o)&&(q=!0,s.setWorldDataset(o),s.setCanvasColor(u),s.setSphereColor(E),s.setWaterColor(g),s.setBoundariesColor(W),s.setEarthColor(H),s.setHoverColor(I),s.drawMapWithCalculations())}const U=()=>{s.setCanvasColor(u),s.drawMapWithoutCalculations()},b=()=>{s.setSphereColor(E),s.drawMapWithoutCalculations()},G=()=>{s.setWaterColor(g),s.drawMapWithoutCalculations()},x=()=>{s.setBoundariesColor(W),s.drawMapWithoutCalculations()},B=()=>{s.setEarthColor(H),s.drawMapWithoutCalculations()},A=()=>{s.setHoverColor(I),s.drawMapWithoutCalculations()};function X(C){Lt[C?"unshift":"push"](()=>{l=C,e(2,l)})}function M(){u=this.value,e(3,u)}function Y(){E=this.value,e(4,E)}function D(){g=this.value,e(5,g)}function V(){W=this.value,e(6,W)}function Z(){H=this.value,e(7,H)}function F(){I=this.value,e(8,I)}return r.$$set=C=>{"worldDataset"in C&&e(16,o=C.worldDataset),"width"in C&&e(0,a=C.width),"height"in C&&e(1,i=C.height)},[a,i,l,u,E,g,W,H,I,S,U,b,G,x,B,A,o,X,M,Y,D,V,Z,F]}class Gt extends lt{constructor(t){super();ut(this,t,Ut,Tt,ct,{worldDataset:16,width:0,height:1})}}class At{constructor(t,e){this.lowResolution=t,this.highResolution=e}get minResolution(){return this.lowResolution||this.highResolution}get maxResolution(){return this.highResolution||this.lowResolution}}function Xt(r){let t,e,o,a;return e=new Gt({props:{worldDataset:r[2],width:r[0],height:r[1]}}),{c(){t=c("div"),Et(e.$$.fragment),this.h()},l(i){t=p(i,"DIV",{class:!0});var s=_(t);Wt(e.$$.fragment,s),s.forEach(d),this.h()},h(){v(t,"class","svelte-10lepfb"),kt(()=>r[3].call(t))},m(i,s){st(i,t,s),St(e,t,null),o=Bt(t,r[3].bind(t)),a=!0},p(i,[s]){const l={};s&4&&(l.worldDataset=i[2]),s&1&&(l.width=i[0]),s&2&&(l.height=i[1]),e.$set(l)},i(i){a||(bt(e.$$.fragment,i),a=!0)},o(i){xt(e.$$.fragment,i),a=!1},d(i){i&&d(t),Mt(e),o()}}}function Yt(r,t,e){let o,a,i;Vt(()=>{Promise.all([Rt("countries-110m.topo.json"),Rt("countries-50m.topo.json")]).then(([l,u])=>{const E=yt(l,l.objects.countries),g=yt(u,u.objects.countries);e(2,i=new At(E,g))})});function s(){o=this.clientWidth,a=this.clientHeight,e(0,o),e(1,a)}return[o,a,i,s]}class Zt extends lt{constructor(t){super();ut(this,t,Yt,Xt,ct,{})}}function Ft(r){let t,e;return t=new Zt({}),{c(){Et(t.$$.fragment)},l(o){Wt(t.$$.fragment,o)},m(o,a){St(t,o,a),e=!0},p:ht,i(o){e||(bt(t.$$.fragment,o),e=!0)},o(o){xt(t.$$.fragment,o),e=!1},d(o){Mt(t,o)}}}class Kt extends lt{constructor(t){super();ut(this,t,null,Ft,ct,{})}}export{Kt as default};
