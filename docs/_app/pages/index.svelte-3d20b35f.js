import{M as V,N as _,O as x,P as G,Q as l,R,S as m,i as w,s as C,e as D,c as E,a as b,d as g,b as u,g as L,T,L as p,U as B,V as F,w as S,x as j,W as I,y as M,X as U,q as W,o as H,B as k,v as q,Y as P,Z as y}from"../chunks/vendor-9fac88bb.js";function X(i,t){let e;return(...s)=>{clearTimeout(e),e=setTimeout(()=>{i.apply(this,s)},t)}}var d=(i=>(i.DEFAULT="darkslategray",i.HOVERED="green",i))(d||{});function Z(i,t,e,s){!i||!t||!e||!s||i.fitSize([t,e],s)}class Y{constructor(){this.processing=!1,this.onMouseMove=t=>{var a;if(this.processing||!((a=this.countries)!=null&&a.length))return;const e=this.canvasContext.canvas.getBoundingClientRect(),s=t.offsetY-e.y,o=t.offsetX-e.x,n=this.countries.find(r=>{const h=this.processing?r.pathLowResolution:r.pathHighResolution;return this.canvasContext.isPointInPath(h,o,s)});this.hoveredCountry!==n&&(this.hoveredCountry&&(this.hoveredCountry.color=d.DEFAULT,this.hoveredCountry.isHovered=!1),n?(this.hoveredCountry=n,this.hoveredCountry.color=d.HOVERED,this.hoveredCountry.isHovered=!0):this.hoveredCountry=null,this.renderCanvas())}}init(t){this.initVariables(t),this.initPanAndZoomListener(),this.initHoverListener()}setWorldDataset(t){var e,s,o,n;!((s=(e=t==null?void 0:t.lowResolution)==null?void 0:e.features)!=null&&s.length)||!((n=(o=t==null?void 0:t.highResolution)==null?void 0:o.features)!=null&&n.length)||(this.worldDataset=t,this.countries=this.worldDataset.maxResolution.features.map(a=>({featureLowResolution:this.worldDataset.minResolution.features.find(h=>h.properties.name===a.properties.name),featureHighResolution:a,pathLowResolution:null,pathHighResolution:null,name:a.properties.name,color:d.DEFAULT,isHovered:!1})))}drawMap(){Z(this.projection,this.width,this.height,this.worldDataset.maxResolution),this.setCountriesPaths(),this.renderCanvas()}initVariables(t){this.projection=V(),this.canvasContext=t.getContext("2d"),this.pathGenerator=_(this.projection),this.pathGeneratorWithContext=_(this.projection,this.canvasContext)}initPanAndZoomListener(){x(this.canvasContext.canvas).call(G().scaleExtent([1,8]).on("start",t=>{this.processing=!0;const e=this.projection.rotate();this.versorOnDragStart={rotate:e,cartesian:l.cartesian(this.projection.invert(R(t.sourceEvent,this.canvasContext.canvas))),matrix:l(e)}}).on("zoom",t=>{this.projection.scale(t.transform.k*(this.height/2));const e=l.cartesian(this.projection.rotate(this.versorOnDragStart.rotate).invert(R(t.sourceEvent,this.canvasContext.canvas))),s=l.multiply(this.versorOnDragStart.matrix,l.delta(this.versorOnDragStart.cartesian,e));this.projection.rotate(l.rotation(s)),this.setCountriesPaths(),this.renderCanvas()}).on("end",()=>{this.processing=!1,this.setCountriesPaths(),this.renderCanvas()}))}initHoverListener(){x(this.canvasContext.canvas).on("mousemove",this.onMouseMove)}setCountriesPaths(){this.processing?this.countries.forEach(t=>{t.pathLowResolution=t.featureLowResolution?new Path2D(this.pathGenerator(t.featureLowResolution)):null}):this.countries.forEach(t=>{t.pathHighResolution=new Path2D(this.pathGenerator(t.featureHighResolution))})}renderCanvas(){window.requestAnimationFrame(()=>{this.canvasContext.clearRect(0,0,this.width,this.height),this.drawWater(),this.countries.forEach(t=>{this.drawCountry(t)}),this.drawEarthBoundary()})}drawWater(){this.canvasContext.beginPath(),this.pathGeneratorWithContext({type:"Sphere"}),this.canvasContext.fillStyle="white",this.canvasContext.fill(),this.canvasContext.closePath()}drawCountry(t){const e=this.processing?t.pathLowResolution:t.pathHighResolution;!e||(this.canvasContext.beginPath(),this.canvasContext.strokeStyle="white",this.canvasContext.stroke(e),this.canvasContext.fillStyle=t.color,this.canvasContext.fill(e),this.canvasContext.closePath())}drawEarthBoundary(){this.canvasContext.beginPath(),this.pathGeneratorWithContext({type:"Sphere"}),this.canvasContext.strokeStyle="darkslategray",this.canvasContext.stroke(),this.canvasContext.closePath()}get width(){return this.canvasContext.canvas.width}get height(){return this.canvasContext.canvas.height}}function N(i){let t,e,s;return{c(){t=D("canvas"),this.h()},l(o){t=E(o,"CANVAS",{width:!0,height:!0}),b(t).forEach(g),this.h()},h(){u(t,"width",i[0]),u(t,"height",i[1])},m(o,n){L(o,t,n),i[5](t),e||(s=T(window,"resize",i[3]),e=!0)},p(o,[n]){n&1&&u(t,"width",o[0]),n&2&&u(t,"height",o[1])},i:p,o:p,d(o){o&&g(t),i[5](null),e=!1,s()}}}const Q=300;function K(i,t,e){let{worldDataset:s}=t,{width:o}=t,{height:n}=t;const a=new Y;let r,h=!1,f=!1;const v=X(()=>{a.drawMap()},Q);B(()=>{A()});function z(){h||!r||(h=!0,a.init(r))}function A(){z(),!(!h||f||!s)&&(f=!0,a.setWorldDataset(s),a.drawMap())}function O(c){F[c?"unshift":"push"](()=>{r=c,e(2,r)})}return i.$$set=c=>{"worldDataset"in c&&e(4,s=c.worldDataset),"width"in c&&e(0,o=c.width),"height"in c&&e(1,n=c.height)},[o,n,r,v,s,O]}class $ extends m{constructor(t){super();w(this,t,K,N,C,{worldDataset:4,width:0,height:1})}}class J{constructor(t,e){this.lowResolution=t,this.highResolution=e}get minResolution(){return this.lowResolution||this.highResolution}get maxResolution(){return this.highResolution||this.lowResolution}}function tt(i){let t,e,s,o;return e=new $({props:{worldDataset:i[2],width:i[0],height:i[1]}}),{c(){t=D("div"),S(e.$$.fragment),this.h()},l(n){t=E(n,"DIV",{class:!0});var a=b(t);j(e.$$.fragment,a),a.forEach(g),this.h()},h(){u(t,"class","svelte-1v92ok3"),I(()=>i[3].call(t))},m(n,a){L(n,t,a),M(e,t,null),s=U(t,i[3].bind(t)),o=!0},p(n,[a]){const r={};a&4&&(r.worldDataset=n[2]),a&1&&(r.width=n[0]),a&2&&(r.height=n[1]),e.$set(r)},i(n){o||(W(e.$$.fragment,n),o=!0)},o(n){H(e.$$.fragment,n),o=!1},d(n){n&&g(t),k(e),s()}}}function et(i,t,e){let s,o,n;q(()=>{Promise.all([P("countries-110m.topo.json"),P("countries-50m.topo.json")]).then(([r,h])=>{const f=y(r,r.objects.countries),v=y(h,h.objects.countries);e(2,n=new J(f,v))})});function a(){s=this.clientWidth,o=this.clientHeight,e(0,s),e(1,o)}return[s,o,n,a]}class st extends m{constructor(t){super();w(this,t,et,tt,C,{})}}function nt(i){let t,e;return t=new st({}),{c(){S(t.$$.fragment)},l(s){j(t.$$.fragment,s)},m(s,o){M(t,s,o),e=!0},p,i(s){e||(W(t.$$.fragment,s),e=!0)},o(s){H(t.$$.fragment,s),e=!1},d(s){k(t,s)}}}class ot extends m{constructor(t){super();w(this,t,null,nt,C,{})}}export{ot as default};
