import{M as Rt,N as ct,O as pt,P as yt,Q as z,R as ft,S as ot,i as st,s as rt,e as p,t as q,k as x,c as f,a as _,h as X,d,m as M,b as v,g as $,H as i,T as D,U as R,L as et,V as Et,W as Wt,X as bt,w as Ct,x as gt,Y as St,y as wt,Z as xt,q as _t,o as mt,B as Pt,v as Mt,_ as dt,$ as vt}from"../chunks/vendor-6312896e.js";function Dt(s,t){let e;return(...r)=>{clearTimeout(e),e=setTimeout(()=>{s.apply(this,r)},t)}}function Ht(s,t,e,r){!s||!t||!e||!r||s.fitSize([t,e],r)}class It{constructor(){this.processing=!1,this.sphereColor="darkslategray",this.waterColor="white",this.boundariesColor="white",this.earthColor="darkslategray",this.hoverColor="green",this.onMouseMove=t=>{var o;if(this.processing||!((o=this.countries)!=null&&o.length))return;const e=this.canvasContext.canvas.getBoundingClientRect(),r=t.offsetY-e.y,a=t.offsetX-e.x,n=this.countries.find(l=>{const u=this.processing?l.pathLowResolution:l.pathHighResolution;return this.canvasContext.isPointInPath(u,a,r)});this.hoveredCountry!==n&&(this.hoveredCountry&&(this.hoveredCountry.color=this.earthColor,this.hoveredCountry.isHovered=!1),n?(this.hoveredCountry=n,this.hoveredCountry.color=this.hoverColor,this.hoveredCountry.isHovered=!0):this.hoveredCountry=null,this.renderCanvas())}}init(t){this.initVariables(t),this.initPanAndZoomListener(),this.initHoverListener()}setWorldDataset(t){var e,r,a,n;!((r=(e=t==null?void 0:t.lowResolution)==null?void 0:e.features)!=null&&r.length)||!((n=(a=t==null?void 0:t.highResolution)==null?void 0:a.features)!=null&&n.length)||(this.worldDataset=t,this.countries=this.worldDataset.maxResolution.features.map(o=>({featureLowResolution:this.worldDataset.minResolution.features.find(u=>u.properties.name===o.properties.name),featureHighResolution:o,pathLowResolution:null,pathHighResolution:null,name:o.properties.name,color:this.earthColor,isHovered:!1})))}setSphereColor(t){this.sphereColor=t}setWaterColor(t){this.waterColor=t}setBoundariesColor(t){this.boundariesColor=t}setEarthColor(t){this.earthColor=t,this.countries.forEach(e=>e.isHovered?null:e.color=t)}setHoverColor(t){this.hoverColor=t,this.hoveredCountry&&(this.hoveredCountry.color=t)}drawMapWithCalculations(){Ht(this.projection,this.width,this.height,this.worldDataset.maxResolution),this.setCountriesPaths(),this.renderCanvas()}drawMapWithoutCalculations(){this.renderCanvas()}initVariables(t){this.projection=Rt(),this.canvasContext=t.getContext("2d"),this.pathGenerator=ct(this.projection),this.pathGeneratorWithContext=ct(this.projection,this.canvasContext)}initPanAndZoomListener(){pt(this.canvasContext.canvas).call(yt().scaleExtent([1,8]).on("start",t=>{this.processing=!0;const e=this.projection.rotate();this.versorOnDragStart={rotate:e,cartesian:z.cartesian(this.projection.invert(ft(t.sourceEvent,this.canvasContext.canvas))),matrix:z(e)}}).on("zoom",t=>{this.projection.scale(t.transform.k*(this.height/2));const e=z.cartesian(this.projection.rotate(this.versorOnDragStart.rotate).invert(ft(t.sourceEvent,this.canvasContext.canvas))),r=z.multiply(this.versorOnDragStart.matrix,z.delta(this.versorOnDragStart.cartesian,e));this.projection.rotate(z.rotation(r)),this.setCountriesPaths(),this.renderCanvas()}).on("end",()=>{this.processing=!1,this.setCountriesPaths(),this.renderCanvas()}))}initHoverListener(){pt(this.canvasContext.canvas).on("mousemove",this.onMouseMove)}setCountriesPaths(){this.processing?this.countries.forEach(t=>{t.pathLowResolution=t.featureLowResolution?new Path2D(this.pathGenerator(t.featureLowResolution)):null}):this.countries.forEach(t=>{t.pathHighResolution=new Path2D(this.pathGenerator(t.featureHighResolution))})}renderCanvas(){window.requestAnimationFrame(()=>{this.canvasContext.clearRect(0,0,this.width,this.height),this.drawWater(),this.countries.forEach(t=>{this.drawCountry(t)}),this.drawEarthBoundary()})}drawWater(){this.canvasContext.beginPath(),this.pathGeneratorWithContext({type:"Sphere"}),this.canvasContext.fillStyle=this.waterColor,this.canvasContext.fill(),this.canvasContext.closePath()}drawCountry(t){const e=this.processing?t.pathLowResolution:t.pathHighResolution;!e||(this.canvasContext.beginPath(),this.canvasContext.strokeStyle=this.boundariesColor,this.canvasContext.stroke(e),this.canvasContext.fillStyle=t.color,this.canvasContext.fill(e),this.canvasContext.closePath())}drawEarthBoundary(){this.canvasContext.beginPath(),this.pathGeneratorWithContext({type:"Sphere"}),this.canvasContext.strokeStyle=this.sphereColor,this.canvasContext.stroke(),this.canvasContext.closePath()}get width(){return this.canvasContext.canvas.width}get height(){return this.canvasContext.canvas.height}}function jt(s){let t,e,r,a,n,o,l,u,g,m,H,C,j,P,L,B,O,y,T,E,V,N,U,W,G,b,k,A,w,I,Y,S,tt,nt;return{c(){t=p("div"),e=p("div"),r=p("p"),a=q("Sphere"),n=x(),o=p("input"),l=x(),u=p("div"),g=p("p"),m=q("Water"),H=x(),C=p("input"),j=x(),P=p("div"),L=p("p"),B=q("Boundaries"),O=x(),y=p("input"),T=x(),E=p("div"),V=p("p"),N=q("Earth"),U=x(),W=p("input"),G=x(),b=p("div"),k=p("p"),A=q("Hover"),w=x(),I=p("input"),Y=x(),S=p("canvas"),this.h()},l(c){t=f(c,"DIV",{class:!0});var h=_(t);e=f(h,"DIV",{class:!0});var Z=_(e);r=f(Z,"P",{});var it=_(r);a=X(it,"Sphere"),it.forEach(d),n=M(Z),o=f(Z,"INPUT",{type:!0}),Z.forEach(d),l=M(h),u=f(h,"DIV",{class:!0});var F=_(u);g=f(F,"P",{});var at=_(g);m=X(at,"Water"),at.forEach(d),H=M(F),C=f(F,"INPUT",{type:!0}),F.forEach(d),j=M(h),P=f(h,"DIV",{class:!0});var Q=_(P);L=f(Q,"P",{});var ht=_(L);B=X(ht,"Boundaries"),ht.forEach(d),O=M(Q),y=f(Q,"INPUT",{type:!0}),Q.forEach(d),T=M(h),E=f(h,"DIV",{class:!0});var K=_(E);V=f(K,"P",{});var lt=_(V);N=X(lt,"Earth"),lt.forEach(d),U=M(K),W=f(K,"INPUT",{type:!0}),K.forEach(d),G=M(h),b=f(h,"DIV",{class:!0});var J=_(b);k=f(J,"P",{});var ut=_(k);A=X(ut,"Hover"),ut.forEach(d),w=M(J),I=f(J,"INPUT",{type:!0}),J.forEach(d),h.forEach(d),Y=M(c),S=f(c,"CANVAS",{width:!0,height:!0}),_(S).forEach(d),this.h()},h(){v(o,"type","color"),v(e,"class","color svelte-wnf8xa"),v(C,"type","color"),v(u,"class","color svelte-wnf8xa"),v(y,"type","color"),v(P,"class","color svelte-wnf8xa"),v(W,"type","color"),v(E,"class","color svelte-wnf8xa"),v(I,"type","color"),v(b,"class","color svelte-wnf8xa"),v(t,"class","colors svelte-wnf8xa"),v(S,"width",s[0]),v(S,"height",s[1])},m(c,h){$(c,t,h),i(t,e),i(e,r),i(r,a),i(e,n),i(e,o),D(o,s[3]),i(t,l),i(t,u),i(u,g),i(g,m),i(u,H),i(u,C),D(C,s[4]),i(t,j),i(t,P),i(P,L),i(L,B),i(P,O),i(P,y),D(y,s[5]),i(t,T),i(t,E),i(E,V),i(V,N),i(E,U),i(E,W),D(W,s[6]),i(t,G),i(t,b),i(b,k),i(k,A),i(b,w),i(b,I),D(I,s[7]),$(c,Y,h),$(c,S,h),s[20](S),tt||(nt=[R(window,"resize",s[8]),R(o,"input",s[15]),R(o,"change",s[9]),R(C,"input",s[16]),R(C,"change",s[10]),R(y,"input",s[17]),R(y,"change",s[11]),R(W,"input",s[18]),R(W,"change",s[12]),R(I,"input",s[19]),R(I,"change",s[13])],tt=!0)},p(c,[h]){h&8&&D(o,c[3]),h&16&&D(C,c[4]),h&32&&D(y,c[5]),h&64&&D(W,c[6]),h&128&&D(I,c[7]),h&1&&v(S,"width",c[0]),h&2&&v(S,"height",c[1])},i:et,o:et,d(c){c&&d(t),c&&d(Y),c&&d(S),s[20](null),tt=!1,Et(nt)}}}const Lt=300;function Vt(s,t,e){let{worldDataset:r}=t,{width:a}=t,{height:n}=t;const o=new It;let l,u="#2f4f4f",g="#ffffff",m="#ffffff",H="#2f4f4f",C="#3e9987",j=!1,P=!1;const L=Dt(()=>{o.drawMapWithCalculations()},Lt);Wt(()=>{O()});function B(){j||!l||(j=!0,o.init(l))}function O(){B(),!(!j||P||!r)&&(P=!0,o.setWorldDataset(r),o.setSphereColor(u),o.setWaterColor(g),o.setBoundariesColor(m),o.setEarthColor(H),o.setHoverColor(C),o.drawMapWithCalculations())}const y=()=>{o.setSphereColor(u),o.drawMapWithoutCalculations()},T=()=>{o.setWaterColor(g),o.drawMapWithoutCalculations()},E=()=>{o.setBoundariesColor(m),o.drawMapWithoutCalculations()},V=()=>{o.setEarthColor(H),o.drawMapWithoutCalculations()},N=()=>{o.setHoverColor(C),o.drawMapWithoutCalculations()};function U(){u=this.value,e(3,u)}function W(){g=this.value,e(4,g)}function G(){m=this.value,e(5,m)}function b(){H=this.value,e(6,H)}function k(){C=this.value,e(7,C)}function A(w){bt[w?"unshift":"push"](()=>{l=w,e(2,l)})}return s.$$set=w=>{"worldDataset"in w&&e(14,r=w.worldDataset),"width"in w&&e(0,a=w.width),"height"in w&&e(1,n=w.height)},[a,n,l,u,g,m,H,C,L,y,T,E,V,N,r,U,W,G,b,k,A]}class kt extends ot{constructor(t){super();st(this,t,Vt,jt,rt,{worldDataset:14,width:0,height:1})}}class zt{constructor(t,e){this.lowResolution=t,this.highResolution=e}get minResolution(){return this.lowResolution||this.highResolution}get maxResolution(){return this.highResolution||this.lowResolution}}function Bt(s){let t,e,r,a;return e=new kt({props:{worldDataset:s[2],width:s[0],height:s[1]}}),{c(){t=p("div"),Ct(e.$$.fragment),this.h()},l(n){t=f(n,"DIV",{class:!0});var o=_(t);gt(e.$$.fragment,o),o.forEach(d),this.h()},h(){v(t,"class","svelte-10lepfb"),St(()=>s[3].call(t))},m(n,o){$(n,t,o),wt(e,t,null),r=xt(t,s[3].bind(t)),a=!0},p(n,[o]){const l={};o&4&&(l.worldDataset=n[2]),o&1&&(l.width=n[0]),o&2&&(l.height=n[1]),e.$set(l)},i(n){a||(_t(e.$$.fragment,n),a=!0)},o(n){mt(e.$$.fragment,n),a=!1},d(n){n&&d(t),Pt(e),r()}}}function Ot(s,t,e){let r,a,n;Mt(()=>{Promise.all([dt("countries-110m.topo.json"),dt("countries-50m.topo.json")]).then(([l,u])=>{const g=vt(l,l.objects.countries),m=vt(u,u.objects.countries);e(2,n=new zt(g,m))})});function o(){r=this.clientWidth,a=this.clientHeight,e(0,r),e(1,a)}return[r,a,n,o]}class Tt extends ot{constructor(t){super();st(this,t,Ot,Bt,rt,{})}}function Nt(s){let t,e;return t=new Tt({}),{c(){Ct(t.$$.fragment)},l(r){gt(t.$$.fragment,r)},m(r,a){wt(t,r,a),e=!0},p:et,i(r){e||(_t(t.$$.fragment,r),e=!0)},o(r){mt(t.$$.fragment,r),e=!1},d(r){Pt(t,r)}}}class Gt extends ot{constructor(t){super();st(this,t,null,Nt,rt,{})}}export{Gt as default};
