import{M as F,N as x,O as R,P as O,Q as c,R as _,S as p,i as w,s as C,e as E,c as S,a as b,d as g,b as u,g as D,T as V,L as m,U as Z,V as G,w as L,x as j,W as q,y as H,X as T,q as M,o as k,B as z,v as I,Y as P,Z as y}from"../chunks/vendor-9fac88bb.js";function U(n,t){let e;return(...s)=>{clearTimeout(e),e=setTimeout(()=>{n.apply(this,s)},t)}}var f=(n=>(n.DEFAULT="darkslategray",n.HOVERED="green",n))(f||{});function X(n,t,e,s){!n||!t||!e||!s||n.fitSize([t,e],s)}class Y{constructor(){this.isZooming=!1,this.isDragging=!1,this.onMouseMove=t=>{var a;if(this.mapProcessing||!((a=this.countries)!=null&&a.length))return;const e=this.canvasContext.canvas.getBoundingClientRect(),s=t.offsetY-e.y,o=t.offsetX-e.x,i=this.countries.find(r=>{const h=this.mapProcessing?r.pathLowResolution:r.pathHighResolution;return this.canvasContext.isPointInPath(h,o,s)});this.hoveredCountry!==i&&(this.hoveredCountry&&(this.hoveredCountry.color=f.DEFAULT,this.hoveredCountry.isHovered=!1,this.drawCountry(this.hoveredCountry),i||(this.drawCountriesBoundaries(),this.drawEarthBoundary())),i?(this.hoveredCountry=i,this.hoveredCountry.color=f.HOVERED,this.hoveredCountry.isHovered=!0,this.drawCountry(this.hoveredCountry),this.drawCountriesBoundaries(),this.drawEarthBoundary()):this.hoveredCountry=null)},this.renderCanvas=()=>{this.canvasContext.clearRect(0,0,this.width,this.height),this.canvasContext.beginPath(),this.pathGeneratorWithContext({type:"Sphere"}),this.canvasContext.fillStyle="white",this.canvasContext.fill(),this.canvasContext.closePath(),this.countries.forEach(t=>{this.drawCountry(t)}),this.mapProcessing||this.drawCountriesBoundaries(),this.drawEarthBoundary()}}init(t){this.initVariables(t),this.initPanAndZoomListener(),this.initHoverListener()}setWorldSataset(t){var e,s,o,i;!((s=(e=t==null?void 0:t.lowResolution)==null?void 0:e.features)!=null&&s.length)||!((i=(o=t==null?void 0:t.highResolution)==null?void 0:o.features)!=null&&i.length)||(this.worldDataset=t,this.countries=this.worldDataset.maxResolution.features.map(a=>({featureLowResolution:this.worldDataset.minResolution.features.find(h=>h.properties.name===a.properties.name),featureHighResolution:a,pathLowResolution:null,pathHighResolution:null,name:a.properties.name,color:f.DEFAULT,isHovered:!1})))}drawMap(){X(this.projection,this.width,this.height,this.worldDataset.maxResolution),window.requestAnimationFrame(this.renderCanvas)}initVariables(t){this.projection=F(),this.canvasContext=t.getContext("2d"),this.pathGenerator=x(this.projection),this.pathGeneratorWithContext=x(this.projection,this.canvasContext)}initPanAndZoomListener(){R(this.canvasContext.canvas).call(O().scaleExtent([1,8]).on("start",t=>{this.isZooming=!0;const e=this.projection.rotate();this.versorOnDragStart={rotate:e,cartesian:c.cartesian(this.projection.invert(_(t.sourceEvent,this.canvasContext.canvas))),matrix:c(e)}}).on("zoom",t=>{this.projection.scale(t.transform.k*(this.height/2));const e=c.cartesian(this.projection.rotate(this.versorOnDragStart.rotate).invert(_(t.sourceEvent,this.canvasContext.canvas))),s=c.multiply(this.versorOnDragStart.matrix,c.delta(this.versorOnDragStart.cartesian,e));this.projection.rotate(c.rotation(s)),window.requestAnimationFrame(this.renderCanvas)}).on("end",()=>{this.isZooming=!1,window.requestAnimationFrame(this.renderCanvas)}))}initHoverListener(){R(this.canvasContext.canvas).on("mousemove",this.onMouseMove)}drawCountry(t){if(!(this.mapProcessing?t.featureLowResolution:t.featureHighResolution))return;let s;this.mapProcessing?s=t.pathLowResolution=t.featureLowResolution?new Path2D(this.pathGenerator(t.featureLowResolution)):null:s=t.pathHighResolution=new Path2D(this.pathGenerator(t.featureHighResolution)),this.canvasContext.beginPath(),this.canvasContext.fillStyle=t.color,this.canvasContext.fill(s),this.canvasContext.closePath()}drawCountriesBoundaries(){this.countries.forEach(t=>{const e=this.mapProcessing?t.pathLowResolution:t.pathHighResolution;!e||(this.canvasContext.beginPath(),this.canvasContext.strokeStyle="white",this.canvasContext.stroke(e),this.canvasContext.fillStyle=t.color,this.canvasContext.fill(e),this.canvasContext.closePath())})}drawEarthBoundary(){this.canvasContext.beginPath(),this.pathGeneratorWithContext({type:"Sphere"}),this.canvasContext.strokeStyle="darkslategray",this.canvasContext.stroke(),this.canvasContext.closePath()}get width(){return this.canvasContext.canvas.width}get height(){return this.canvasContext.canvas.height}get mapProcessing(){return this.isDragging||this.isZooming}}function N(n){let t,e,s;return{c(){t=E("canvas"),this.h()},l(o){t=S(o,"CANVAS",{width:!0,height:!0}),b(t).forEach(g),this.h()},h(){u(t,"width",n[0]),u(t,"height",n[1])},m(o,i){D(o,t,i),n[5](t),e||(s=V(window,"resize",n[3]),e=!0)},p(o,[i]){i&1&&u(t,"width",o[0]),i&2&&u(t,"height",o[1])},i:m,o:m,d(o){o&&g(t),n[5](null),e=!1,s()}}}const Q=300;function K(n,t,e){let{worldDataset:s}=t,{width:o}=t,{height:i}=t;const a=new Y;let r,h=!1,d=!1;const v=U(()=>{a.drawMap()},Q);Z(()=>{B()});function A(){h||!r||(h=!0,a.init(r))}function B(){A(),!(!h||d||!s)&&(d=!0,a.setWorldSataset(s),a.drawMap())}function W(l){G[l?"unshift":"push"](()=>{r=l,e(2,r)})}return n.$$set=l=>{"worldDataset"in l&&e(4,s=l.worldDataset),"width"in l&&e(0,o=l.width),"height"in l&&e(1,i=l.height)},[o,i,r,v,s,W]}class $ extends p{constructor(t){super();w(this,t,K,N,C,{worldDataset:4,width:0,height:1})}}class J{constructor(t,e){this.lowResolution=t,this.highResolution=e}get minResolution(){return this.lowResolution||this.highResolution}get maxResolution(){return this.highResolution||this.lowResolution}}function tt(n){let t,e,s,o;return e=new $({props:{worldDataset:n[2],width:n[0],height:n[1]}}),{c(){t=E("div"),L(e.$$.fragment),this.h()},l(i){t=S(i,"DIV",{class:!0});var a=b(t);j(e.$$.fragment,a),a.forEach(g),this.h()},h(){u(t,"class","svelte-1v92ok3"),q(()=>n[3].call(t))},m(i,a){D(i,t,a),H(e,t,null),s=T(t,n[3].bind(t)),o=!0},p(i,[a]){const r={};a&4&&(r.worldDataset=i[2]),a&1&&(r.width=i[0]),a&2&&(r.height=i[1]),e.$set(r)},i(i){o||(M(e.$$.fragment,i),o=!0)},o(i){k(e.$$.fragment,i),o=!1},d(i){i&&g(t),z(e),s()}}}function et(n,t,e){let s,o,i;I(()=>{Promise.all([P("countries-110m.topo.json"),P("countries-50m.topo.json")]).then(([r,h])=>{const d=y(r,r.objects.countries),v=y(h,h.objects.countries);e(2,i=new J(d,v))})});function a(){s=this.clientWidth,o=this.clientHeight,e(0,s),e(1,o)}return[s,o,i,a]}class st extends p{constructor(t){super();w(this,t,et,tt,C,{})}}function it(n){let t,e;return t=new st({}),{c(){L(t.$$.fragment)},l(s){j(t.$$.fragment,s)},m(s,o){H(t,s,o),e=!0},p:m,i(s){e||(M(t.$$.fragment,s),e=!0)},o(s){k(t.$$.fragment,s),e=!1},d(s){z(t,s)}}}class ot extends p{constructor(t){super();w(this,t,null,it,C,{})}}export{ot as default};
